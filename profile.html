<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="mobile-screen">
        
        <header class="header">
            <span class="header-title">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</span>
            <a href="profile.html" class="profile-icon"></a>
        </header>
        
        <div class="content">
            <h2 class="page-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>

            <div class="form-group">
                <label for="edit-weight">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)</label>
                <input type="text" id="edit-weight">
            </div>
            
            <div class="form-group">
                <label for="edit-height">‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (cm)</label>
                <input type="text" id="edit-height">
            </div>

            <button id="recalcBtn" class="btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà</button>
            
            <div class="bmi-result-box" id="profile-bmi-box">
                <strong>‡∏Ñ‡πà‡∏≤ BMI:</strong> <span id="profile-bmi">--.-</span>
                <br>
                <small>(‡∏Ñ‡∏ß‡∏£‡∏Å‡∏¥‡∏ô <span id="profile-calories">----</span> ‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà)</small>
            </div>
            
            <table class="bmi-table">
                <thead>
                    <tr>
                        <th>‡∏Ñ‡πà‡∏≤‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á</th>
                        <th>‡∏Ñ‡πà‡∏≤ BMI</th>
                    </tr>
                </thead>
                <tbody id="bmi-table-body">
                    <tr>
                        <td>...</td>
                        <td>...</td>
                    </tr>
                </tbody>
            </table>

            <a href="login.html" class="btn btn-secondary-link" style="margin-top: 20px;" id="logoutBtn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
        </div>
        <footer class="footer-nav">
            <a href="home.html" class="footer-icon">‚¨ÖÔ∏è</a>
            <a href="cart.html" class="footer-icon">üõí</a>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 1. ‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            const username = localStorage.getItem('currentUser');
            if (!username) {
                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà login ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ login
                window.location.href = 'login.html';
                return;
            }

            // 2. ‡∏î‡∏∂‡∏á Element ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ
            const editWeight = document.getElementById('edit-weight');
            const editHeight = document.getElementById('edit-height');
            const recalcBtn = document.getElementById('recalcBtn');
            const profileBmi = document.getElementById('profile-bmi');
            const profileCalories = document.getElementById('profile-calories');
            const bmiTableBody = document.getElementById('bmi-table-body');
            const logoutBtn = document.getElementById('logoutBtn');

            // 3. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
            loadProfileData();

            // 4. ‡∏ú‡∏π‡∏Å Event ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà
            recalcBtn.addEventListener('click', function() {
                const newWeight = parseFloat(editWeight.value);
                const newHeight = parseFloat(editHeight.value);

                if (newWeight > 0 && newHeight > 0) {
                    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà
                    const heightInMeters = newHeight / 100;
                    const newBmi = (newWeight / (heightInMeters * heightInMeters)).toFixed(2);
                    const newCalories = (newWeight * 30).toFixed(0); // ‡∏™‡∏π‡∏ï‡∏£‡∏™‡∏°‡∏°‡∏ï‡∏¥

                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á object ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
                    const updatedUserData = {
                        weight: newWeight,
                        height: newHeight,
                        bmi: newBmi,
                        calories: newCalories
                    };

                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡∏ö localStorage
                    localStorage.setItem(username + '_data', JSON.stringify(updatedUserData));

                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
                    updateProfileDisplay(updatedUserData);
                    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß!');
                } else {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                }
            });

            // 5. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            function loadProfileData() {
                const userData = JSON.parse(localStorage.getItem(username + '_data'));
                
                if (userData) {
                    // ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á input
                    editWeight.value = userData.weight;
                    editHeight.value = userData.height;
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
                    updateProfileDisplay(userData);
                } else {
                    // ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ register ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏≠‡∏Å)
                    document.getElementById('profile-bmi-box').innerHTML = 
                        '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• BMI <br> <small>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</small>';
                    bmiTableBody.innerHTML = '<tr><td>-</td><td>-</td></tr>';
                }
            }

            // 6. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (BMI, ‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ, ‡∏ï‡∏≤‡∏£‡∏≤‡∏á)
            function updateProfileDisplay(data) {
                profileBmi.textContent = data.bmi;
                profileCalories.textContent = data.calories;
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á
                const category = getBmiCategory(data.bmi);
                bmiTableBody.innerHTML = `<tr><td>${category.name}</td><td>${category.range}</td></tr>`;
            }

            // 7. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏õ‡∏•‡∏Ñ‡πà‡∏≤ BMI ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            function getBmiCategory(bmi) {
                bmi = parseFloat(bmi);
                if (bmi < 18.5) return { name: '‡∏ú‡∏≠‡∏°‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ', range: '‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 18.5' };
                if (bmi <= 22.9) return { name: '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏õ‡∏Å‡∏ï‡∏¥', range: '18.5 - 22.9' };
                if (bmi <= 24.9) return { name: '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô', range: '23.0 - 24.9' };
                if (bmi <= 29.9) return { name: '‡∏≠‡πâ‡∏ß‡∏ô', range: '25.0 - 29.9' };
                if (bmi >= 30) return { name: '‡∏≠‡πâ‡∏ß‡∏ô‡∏°‡∏≤‡∏Å', range: '30.0 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ' };
                return { name: '-', range: '-' };
            }

            // 8. ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
            logoutBtn.addEventListener('click', function() {
                localStorage.removeItem('currentUser');
                localStorage.removeItem('currentUserRole');
                localStorage.removeItem('cart'); 
            });
        });
    </script>
</body>
</html>