<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Battle</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <div class="mobile-screen">

        <header class="header">
            <a href="home.html" class="back-btn">
                <i class="fas fa-arrow-left"></i>
                <span>‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</span>
            </a>
            <span class="header-title">‚öîÔ∏è Food Battle</span>
            <div style="width: 60px;"></div>
        </header>

        <div class="content">
            <div class="battle-container">
                <h2 class="battle-header">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£ 2 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏≤ Battle!</h2>

                <div class="food-selector">
                    <div class="food-select-box" id="food1Box" onclick="openFoodSelector(1)" 
                         tabindex="0" role="button" 
                         onkeydown="if(event.key === 'Enter' || event.key === ' ') { event.preventDefault(); openFoodSelector(1); }">
                        <h4>‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà 1</h4>
                        <p id="food1Name">‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>
                    </div>
                    <div class="food-select-box" id="food2Box" onclick="openFoodSelector(2)" 
                         tabindex="0" role="button" 
                         onkeydown="if(event.key === 'Enter' || event.key === ' ') { event.preventDefault(); openFoodSelector(2); }">
                        <h4>‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà 2</h4>
                        <p id="food2Name">‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>
                    </div>
                </div>

                <div id="comparisonResult" style="display: none;">
                    <div class="comparison-result">
                        <h3 class="comparison-header">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</h3>
                        
                        <div class="comparison-stats">
                            <div class="stat-item">
                                <div class="stat-label">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà 1</div>
                                <div class="stat-value" id="food1Total">0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà 2</div>
                                <div class="stat-value" id="food2Total">0</div>
                            </div>
                        </div>

                        <div class="bar-chart">
                            <div class="bar-item">
                                <div class="bar-label">
                                    <span>‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô (kcal)</span>
                                    <span id="kcalWinner"></span>
                                </div>
                                <div class="bar-container">
                                    <div class="bar-fill" id="kcalBar1" style="width: 0%;"></div>
                                </div>
                                <div class="bar-container">
                                    <div class="bar-fill" id="kcalBar2" style="width: 0%;"></div>
                                </div>
                            </div>

                            <div class="bar-item">
                                <div class="bar-label">
                                    <span>‡πÑ‡∏Ç‡∏°‡∏±‡∏ô (g)</span>
                                    <span id="fatWinner"></span>
                                </div>
                                <div class="bar-container">
                                    <div class="bar-fill" id="fatBar1" style="width: 0%;"></div>
                                </div>
                                <div class="bar-container">
                                    <div class="bar-fill" id="fatBar2" style="width: 0%;"></div>
                                </div>
                            </div>

                            <div class="bar-item">
                                <div class="bar-label">
                                    <span>‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• (g)</span>
                                    <span id="sugarWinner"></span>
                                </div>
                                <div class="bar-container">
                                    <div class="bar-fill" id="sugarBar1" style="width: 0%;"></div>
                                </div>
                                <div class="bar-container">
                                    <div class="bar-fill" id="sugarBar2" style="width: 0%;"></div>
                                </div>
                            </div>
                        </div>

                        <div class="battle-summary" id="battleSummary">
                            <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h3>
                            <p id="summaryText"></p>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <footer class="footer-nav">
            <a href="home.html" class="footer-icon">üè†</a>
            <a href="health-dashboard.html" class="footer-icon">üìä</a>
            <a href="cart.html" class="footer-icon">üõí</a>
        </footer>

    </div>

    <!-- Food Selection Modal -->
    <div id="foodModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span>
                <span class="close-btn" id="closeBtn">&times;</span>
            </div>
            <div class="modal-body" id="foodList">
                <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const username = localStorage.getItem('currentUser');
            if (!username) {
                window.location.href = 'login.html';
                return;
            }

            let allFoods = [];
            let selectedFood1 = null;
            let selectedFood2 = null;
            let currentSelector = null;

            const modal = document.getElementById("foodModal");
            const foodList = document.getElementById("foodList");
            const closeBtn = document.getElementById("closeBtn");

            // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£
            loadFoods();

            function loadFoods() {
                fetch('http://localhost:8080/api/foods')
                    .then(response => response.json())
                    .then(foods => {
                        allFoods = foods;
                    })
                    .catch(error => {
                        console.error('Error loading foods:', error);
                    });
            }

            // ‡πÄ‡∏õ‡∏¥‡∏î Modal ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£
            window.openFoodSelector = function(foodNumber) {
                currentSelector = foodNumber;
                displayFoodList();
                modal.style.display = "flex";
            }

            function displayFoodList() {
                foodList.innerHTML = '';
                allFoods.forEach(food => {
                    const foodItem = document.createElement('div');
                    foodItem.className = 'menu-item';
                    foodItem.style.cursor = 'pointer';
                    foodItem.innerHTML = `
                        <div class="item-text">
                            <strong>${food.name}</strong>
                            <span>${food.kcal} kcal | ‡πÑ‡∏Ç‡∏°‡∏±‡∏ô: ${food.fat}g | ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•: ${food.sugar}g</span>
                        </div>
                    `;
                    foodItem.addEventListener('click', function() {
                        selectFood(food);
                    });
                    foodList.appendChild(foodItem);
                });
            }

            function selectFood(food) {
                if (currentSelector === 1) {
                    selectedFood1 = food;
                    document.getElementById('food1Name').textContent = food.name;
                    document.getElementById('food1Box').classList.add('selected');
                } else if (currentSelector === 2) {
                    selectedFood2 = food;
                    document.getElementById('food2Name').textContent = food.name;
                    document.getElementById('food2Box').classList.add('selected');
                }
                closeModal();
                
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏£‡∏ö 2 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
                if (selectedFood1 && selectedFood2) {
                    compareFoods();
                }
            }

            function compareFoods() {
                const resultDiv = document.getElementById('comparisonResult');
                resultDiv.style.display = 'block';

                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° (‡πÉ‡∏ä‡πâ kcal ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å)
                const total1 = selectedFood1.kcal;
                const total2 = selectedFood2.kcal;
                
                document.getElementById('food1Total').textContent = total1;
                document.getElementById('food2Total').textContent = total2;

                // ‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö normalization
                const maxKcal = Math.max(selectedFood1.kcal, selectedFood2.kcal);
                const maxFat = Math.max(selectedFood1.fat, selectedFood2.fat);
                const maxSugar = Math.max(selectedFood1.sugar, selectedFood2.sugar);

                // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü Kcal
                const kcal1Percent = (selectedFood1.kcal / maxKcal) * 100;
                const kcal2Percent = (selectedFood2.kcal / maxKcal) * 100;
                document.getElementById('kcalBar1').style.width = kcal1Percent + '%';
                document.getElementById('kcalBar1').textContent = selectedFood1.kcal + ' kcal';
                document.getElementById('kcalBar2').style.width = kcal2Percent + '%';
                document.getElementById('kcalBar2').textContent = selectedFood2.kcal + ' kcal';
                
                if (selectedFood1.kcal > selectedFood2.kcal) {
                    document.getElementById('kcalBar1').classList.add('higher');
                    document.getElementById('kcalWinner').textContent = 'üèÜ ' + selectedFood1.name;
                } else if (selectedFood2.kcal > selectedFood1.kcal) {
                    document.getElementById('kcalBar2').classList.add('higher');
                    document.getElementById('kcalWinner').textContent = 'üèÜ ' + selectedFood2.name;
                } else {
                    document.getElementById('kcalWinner').textContent = '‡πÄ‡∏™‡∏°‡∏≠‡∏Å‡∏±‡∏ô';
                }

                // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü Fat
                const fat1Percent = (selectedFood1.fat / maxFat) * 100;
                const fat2Percent = (selectedFood2.fat / maxFat) * 100;
                document.getElementById('fatBar1').style.width = fat1Percent + '%';
                document.getElementById('fatBar1').textContent = selectedFood1.fat + 'g';
                document.getElementById('fatBar2').style.width = fat2Percent + '%';
                document.getElementById('fatBar2').textContent = selectedFood2.fat + 'g';
                
                if (selectedFood1.fat > selectedFood2.fat) {
                    document.getElementById('fatBar1').classList.add('higher');
                    document.getElementById('fatWinner').textContent = 'üèÜ ' + selectedFood1.name;
                } else if (selectedFood2.fat > selectedFood1.fat) {
                    document.getElementById('fatBar2').classList.add('higher');
                    document.getElementById('fatWinner').textContent = 'üèÜ ' + selectedFood2.name;
                } else {
                    document.getElementById('fatWinner').textContent = '‡πÄ‡∏™‡∏°‡∏≠‡∏Å‡∏±‡∏ô';
                }

                // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü Sugar
                const sugar1Percent = (selectedFood1.sugar / maxSugar) * 100;
                const sugar2Percent = (selectedFood2.sugar / maxSugar) * 100;
                document.getElementById('sugarBar1').style.width = sugar1Percent + '%';
                document.getElementById('sugarBar1').textContent = selectedFood1.sugar + 'g';
                document.getElementById('sugarBar2').style.width = sugar2Percent + '%';
                document.getElementById('sugarBar2').textContent = selectedFood2.sugar + 'g';
                
                if (selectedFood1.sugar > selectedFood2.sugar) {
                    document.getElementById('sugarBar1').classList.add('higher');
                    document.getElementById('sugarWinner').textContent = 'üèÜ ' + selectedFood1.name;
                } else if (selectedFood2.sugar > selectedFood1.sugar) {
                    document.getElementById('sugarBar2').classList.add('higher');
                    document.getElementById('sugarWinner').textContent = 'üèÜ ' + selectedFood2.name;
                } else {
                    document.getElementById('sugarWinner').textContent = '‡πÄ‡∏™‡∏°‡∏≠‡∏Å‡∏±‡∏ô';
                }

                // ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•
                let summary = '';
                if (total1 > total2) {
                    const ratio = (total1 / total2).toFixed(1);
                    summary = `"${selectedFood1.name}" ‡∏≠‡πâ‡∏ß‡∏ô‡∏Å‡∏ß‡πà‡∏≤ "${selectedFood2.name}" ${ratio} ‡πÄ‡∏ó‡πà‡∏≤! (${total1} vs ${total2} kcal)`;
                } else if (total2 > total1) {
                    const ratio = (total2 / total1).toFixed(1);
                    summary = `"${selectedFood2.name}" ‡∏≠‡πâ‡∏ß‡∏ô‡∏Å‡∏ß‡πà‡∏≤ "${selectedFood1.name}" ${ratio} ‡πÄ‡∏ó‡πà‡∏≤! (${total2} vs ${total1} kcal)`;
                } else {
                    summary = `"${selectedFood1.name}" ‡πÅ‡∏•‡∏∞ "${selectedFood2.name}" ‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô! (${total1} kcal)`;
                }
                document.getElementById('summaryText').textContent = summary;

                // Scroll to result
                resultDiv.scrollIntoView({ behavior: 'smooth' });
            }

            function closeModal() {
                modal.style.display = "none";
            }

            closeBtn.onclick = closeModal;
            window.onclick = function (event) {
                if (event.target == modal) {
                    closeModal();
                }
            }
        });
    </script>
</body>

</html>

