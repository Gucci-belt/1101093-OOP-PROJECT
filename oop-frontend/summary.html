<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Summary</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="mobile-screen">
        
        <header class="header">
            <span class="header-title">‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°</span>
            <a href="profile.html" class="profile-icon"></a>
        </header>
        
        <div class="content">
            
            <div class="profile-info-box">
                <strong>‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> <span id="total-items">0</span>
            </div>
            
            <div class="bmi-result-box" style="color: var(--primary-green);">
                <strong>‡∏£‡∏ß‡∏°‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô (Kcal):</strong> <span id="total-kcal">0</span>
            </div>

            <div class="profile-info-box">
                <strong>‡∏£‡∏ß‡∏°‡πÑ‡∏Ç‡∏°‡∏±‡∏ô (g):</strong> <span id="total-fat">0</span>
            </div>
            
            <div class="profile-info-box">
                <strong>‡∏£‡∏ß‡∏°‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• (g):</strong> <span id="total-sugar">0</span>
            </div>

            <div class="profile-info-box">
                <strong>‡∏£‡∏ß‡∏°‡πÇ‡∏ã‡πÄ‡∏î‡∏µ‡∏¢‡∏° (mg):</strong> <span id="total-sodium">0</span>
            </div>

            <a href="home.html" class="btn" style="margin-top: 50px;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</a>
        </div>
        
        <footer class="footer-nav">
            <a href="cart.html" class="footer-icon">‚¨ÖÔ∏è</a>
            <a href="cart.html" class="footer-icon">üõí</a>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ login ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
            const username = localStorage.getItem('currentUser');
            if (!username) {
                window.location.href = 'login.html';
                return;
            }

            // 1. ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏à‡∏≤‡∏Å API
            fetch(`http://localhost:8080/api/cart/${username}`)
                .then(response => response.json())
                .then(cart => {
                    // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•‡∏£‡∏ß‡∏°
                    let totalKcal = 0;
                    let totalFat = 0;
                    let totalSugar = 0;
                    let totalSodium = 0;

                    // 3. ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏ß‡∏Å‡∏Ñ‡πà‡∏≤
                    cart.forEach(item => {
                        totalKcal += item.kcal;
                        totalFat += item.fat;
                        totalSugar += item.sugar;
                        totalSodium += item.sodium;
                    });

                    // 4. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
                    document.getElementById('total-items').textContent = cart.length;
                    document.getElementById('total-kcal').textContent = totalKcal.toFixed(0); 
                    document.getElementById('total-fat').textContent = totalFat.toFixed(1);   
                    document.getElementById('total-sugar').textContent = totalSugar.toFixed(1);
                    document.getElementById('total-sodium').textContent = totalSodium.toFixed(0);
                })
                .catch(error => {
                    console.error('Error loading cart:', error);
                    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÑ‡∏î‡πâ (Backend ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà?)');
                });
        });
    </script>
</body>
</html>